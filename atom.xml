<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>leesea</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2020-04-02T06:27:30.508Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>leesea</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>go 踩坑</title>
    <link href="http://yoursite.com/2020/04/01/go-bug/"/>
    <id>http://yoursite.com/2020/04/01/go-bug/</id>
    <published>2020-04-01T05:25:28.000Z</published>
    <updated>2020-04-02T06:27:30.508Z</updated>
    
    <content type="html"><![CDATA[<ol><li><p>数组里使用指针</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name *<span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">names = []<span class="keyword">string</span>&#123;<span class="string">"tom"</span>, <span class="string">"lina"</span>&#125;</span><br><span class="line">students := []Student&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, name := <span class="keyword">range</span> names &#123;</span><br><span class="line">  <span class="comment">// 这里如果使用 name 的地址，一定要重新赋值, eg:</span></span><br><span class="line">  <span class="comment">// n := name</span></span><br><span class="line">  <span class="comment">// student := Student&#123;</span></span><br><span class="line">  <span class="comment">//    Name: &amp;n</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">  student := Student&#123;</span><br><span class="line">    Name: &amp;name,</span><br><span class="line">  &#125;</span><br><span class="line">  students = <span class="built_in">append</span>(students, student)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, s := <span class="keyword">range</span> students &#123;</span><br><span class="line">  fmt.Println(*s.Name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里输出的全部是： lina</span></span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li>a </li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ol&gt;
&lt;li&gt;&lt;p&gt;数组里使用指针&lt;/p&gt;
&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>mongodb 命令速查</title>
    <link href="http://yoursite.com/2020/03/19/mongo/"/>
    <id>http://yoursite.com/2020/03/19/mongo/</id>
    <published>2020-03-19T06:39:45.000Z</published>
    <updated>2020-05-06T01:25:31.028Z</updated>
    
    <content type="html"><![CDATA[<h2 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo 192.168.1.200:27017/<span class="built_in">test</span> -u user -p password</span><br></pre></td></tr></table></figure><h2 id="db"><a href="#db" class="headerlink" title="db"></a>db</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 db</span></span><br><span class="line">show dbs;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 db</span></span><br><span class="line">use &lt;db_name&gt;;</span><br></pre></td></tr></table></figure><h2 id="collection"><a href="#collection" class="headerlink" title="collection"></a>collection</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 collections</span></span><br><span class="line">show collections;</span><br></pre></td></tr></table></figure><h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建唯一索引</span></span><br><span class="line">db.collection_name.ensureIndex(&#123;<span class="string">"key_name"</span>:1&#125;,&#123;<span class="string">"unique"</span>:<span class="literal">true</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复合唯一索引</span></span><br><span class="line">db.collection_name.ensureIndex(&#123;<span class="string">'key1'</span>:1, <span class="string">'key1'</span>:1&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除文档</span></span><br><span class="line">db.getCollection(<span class="string">'domain'</span>).remove(&#123;<span class="string">"provison_state"</span>: <span class="string">"success"</span>, <span class="string">"industry"</span>: null&#125;)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;连接&quot;&gt;&lt;a href=&quot;#连接&quot; class=&quot;headerlink&quot; title=&quot;连接&quot;&gt;&lt;/a&gt;连接&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span c
      
    
    </summary>
    
      <category term="database" scheme="http://yoursite.com/categories/database/"/>
    
    
      <category term="mongodb" scheme="http://yoursite.com/tags/mongodb/"/>
    
  </entry>
  
  <entry>
    <title>elk</title>
    <link href="http://yoursite.com/2020/03/04/elk/"/>
    <id>http://yoursite.com/2020/03/04/elk/</id>
    <published>2020-03-04T03:53:04.000Z</published>
    <updated>2020-03-04T03:54:36.993Z</updated>
    
    <content type="html"><![CDATA[<h2 id="filebeat"><a href="#filebeat" class="headerlink" title="filebeat"></a>filebeat</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">filebeat.prospectors:</span></span><br><span class="line"><span class="attr">- input_type:</span> <span class="string">log</span></span><br><span class="line"><span class="attr">  paths:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">/opt/logs/aether/aether_log_*.log</span></span><br><span class="line"><span class="attr">  fields:</span></span><br><span class="line"><span class="attr">    log_source:</span> <span class="string">'aether_log'</span></span><br><span class="line"><span class="attr">  multiline:</span></span><br><span class="line"><span class="attr">    pattern:</span> <span class="string">'^\['</span></span><br><span class="line"><span class="attr">    negate:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    match:</span> <span class="string">after</span></span><br><span class="line"><span class="attr">  scan_frequency:</span> <span class="number">2</span><span class="string">s</span></span><br><span class="line"><span class="attr">  max_bytes:</span> <span class="number">104857600</span></span><br><span class="line"><span class="attr">  tail_files:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  close_renamed:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  close_removed:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  close_inactive:</span> <span class="number">45</span><span class="string">m</span></span><br><span class="line"><span class="attr">  force_close_file:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="string">output.logstash:</span></span><br><span class="line"><span class="attr">  hosts:</span> <span class="string">["10.95.54.96:5044",</span> <span class="string">"10.95.54.148:5044"</span><span class="string">]</span></span><br><span class="line"><span class="attr">  worker:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">  loadbalance:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;filebeat&quot;&gt;&lt;a href=&quot;#filebeat&quot; class=&quot;headerlink&quot; title=&quot;filebeat&quot;&gt;&lt;/a&gt;filebeat&lt;/h2&gt;&lt;figure class=&quot;highlight yaml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td cla
      
    
    </summary>
    
    
      <category term="elk" scheme="http://yoursite.com/tags/elk/"/>
    
  </entry>
  
  <entry>
    <title>Jenkinsfile 邮箱配置</title>
    <link href="http://yoursite.com/2020/02/15/jenkins-mail/"/>
    <id>http://yoursite.com/2020/02/15/jenkins-mail/</id>
    <published>2020-02-15T02:43:09.000Z</published>
    <updated>2020-02-15T03:03:21.004Z</updated>
    
    <content type="html"><![CDATA[<p>jenkinsfile 有两种发送邮件方式，一种是用默认的 mail 插件，另一种是使用 <code>Email Extension</code>. 后者的功能稍微多一点，可以提取 git 信息作为收件人。</p><a id="more"></a><ol><li><p>安装 <code>Email Extension Plugin</code> 插件；</p></li><li><p>Jenkinsfile post 部分配置</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">post &#123;</span><br><span class="line">    failure </span><br><span class="line">        emailext(</span><br><span class="line"><span class="symbol">            subject:</span> <span class="string">"Jenkins build is $&#123;currentBuild.result&#125;: $&#123;env.JOB_NAME&#125; #$&#123;env.BUILD_NUMBER&#125;"</span>,</span><br><span class="line"><span class="symbol">            mimeType:</span> <span class="string">"text/html"</span>,</span><br><span class="line"><span class="symbol">            body:</span> <span class="string">"""&lt;p&gt;Jenkins build is $&#123;currentBuild.result&#125;: $&#123;env.JOB_NAME&#125; #$&#123;env.BUILD_NUMBER&#125;:&lt;/p&gt;</span></span><br><span class="line"><span class="string">                     &lt;p&gt;Check console output at &lt;a href="$&#123;env.BUILD_URL&#125;console"&gt;$&#123;env.JOB_NAME&#125; #$&#123;env.BUILD_NUMBER&#125;&lt;/a&gt;&lt;/p&gt;"""</span>,</span><br><span class="line"><span class="symbol">            recipientProviders:</span> [[<span class="string">$class:</span> <span class="string">'CulpritsRecipientProvider'</span>],</span><br><span class="line">                                 [<span class="string">$class:</span> <span class="string">'DevelopersRecipientProvider'</span>],</span><br><span class="line">                                 [<span class="string">$class:</span> <span class="string">'RequesterRecipientProvider'</span>]]</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>如果使用 mail 的方式， post 部分编写如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">post &#123;</span><br><span class="line">    failure &#123;</span><br><span class="line">        mail bcc: &apos;&apos;, body: &quot;&lt;br&gt;Project: $&#123;env.JOB_NAME&#125; &lt;br&gt;Build Number: $&#123;env.BUILD_NUMBER&#125; &lt;br&gt; URL de build: $&#123;env.BUILD_URL&#125;&quot;, cc: &apos;&apos;, charset: &apos;UTF-8&apos;, from: &apos;&apos;, mimeType: &apos;text/html&apos;, replyTo: &apos;&apos;, subject: &quot;ERROR CI: Project name -&gt; $&#123;env.JOB_NAME&#125;&quot;, to: &quot;admin@gmail.com&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h2><p>总结下可以使用的变量</p><ul><li><p><code>${env.JOB_NAME}</code>:  job 的名字</p></li><li><p><code>${env.BUILD_NUMBER}</code>: job 构建号</p></li><li><p><code>${env.BUILD_URL}</code>: job 构建 url</p></li><li><p><code>${env.BUILD_URL}console</code>: job 构建控制台 url, 这里可以自己组织出很多种</p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;jenkinsfile 有两种发送邮件方式，一种是用默认的 mail 插件，另一种是使用 &lt;code&gt;Email Extension&lt;/code&gt;. 后者的功能稍微多一点，可以提取 git 信息作为收件人。&lt;/p&gt;
    
    </summary>
    
      <category term="CI" scheme="http://yoursite.com/categories/CI/"/>
    
    
      <category term="jenkins" scheme="http://yoursite.com/tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>Jenkinsfile 介绍</title>
    <link href="http://yoursite.com/2020/02/15/jenkins-jenkinsfile/"/>
    <id>http://yoursite.com/2020/02/15/jenkins-jenkinsfile/</id>
    <published>2020-02-15T02:06:05.000Z</published>
    <updated>2020-02-15T03:10:00.768Z</updated>
    
    <content type="html"><![CDATA[<p>Jenkinsfile 是用来定义 jenkins pipeline的构建流程。</p><a id="more"></a><p> Jenkinsfile 主要有以下几个部分组成:</p><ol><li>tools: 需要使用的工具;</li><li>agent: 构建的节点；</li><li>stages: 构建流程，可以由多个 stage 组成；</li><li>post: 构建后处理</li></ol><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    tools &#123;</span><br><span class="line">        maven <span class="string">"Maven 3.3.9"</span></span><br><span class="line">        jdk <span class="string">"Oracle JDK 8u40"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    agent &#123; label <span class="string">"any-executor"</span> &#125;</span><br><span class="line"></span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">"build"</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh <span class="string">'echo "path: $&#123;PATH&#125;"'</span></span><br><span class="line">                sh <span class="string">'echo "M2_HOME: $&#123;M2_HOME&#125;"'</span></span><br><span class="line">                sh <span class="string">'mvn clean install -Dmaven.test.failure.ignore=true'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    post &#123;</span><br><span class="line">        always &#123;</span><br><span class="line">            archive <span class="string">"target/**/*"</span></span><br><span class="line">            junit <span class="string">'target/surefire-reports/*.xml'</span></span><br><span class="line">        &#125;</span><br><span class="line">        success &#123;</span><br><span class="line">            mail <span class="string">to:</span><span class="string">"me@example.com"</span>, <span class="string">subject:</span><span class="string">"SUCCESS: $&#123;currentBuild.fullDisplayName&#125;"</span>, <span class="string">body:</span> <span class="string">"Yay, we passed."</span></span><br><span class="line">        &#125;</span><br><span class="line">        failure &#123;</span><br><span class="line">            mail <span class="string">to:</span><span class="string">"me@example.com"</span>, <span class="string">subject:</span><span class="string">"FAILURE: $&#123;currentBuild.fullDisplayName&#125;"</span>, <span class="string">body:</span> <span class="string">"Boo, we failed."</span></span><br><span class="line">        &#125;</span><br><span class="line">        unstable &#123;</span><br><span class="line">            mail <span class="string">to:</span><span class="string">"me@example.com"</span>, <span class="string">subject:</span><span class="string">"UNSTABLE: $&#123;currentBuild.fullDisplayName&#125;"</span>, <span class="string">body:</span> <span class="string">"Huh, we're unstable."</span></span><br><span class="line">        &#125;</span><br><span class="line">        changed &#123;</span><br><span class="line">            mail <span class="string">to:</span><span class="string">"me@example.com"</span>, <span class="string">subject:</span><span class="string">"CHANGED: $&#123;currentBuild.fullDisplayName&#125;"</span>, <span class="string">body:</span> <span class="string">"Wow, our status changed!"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Jenkinsfile 是用来定义 jenkins pipeline的构建流程。&lt;/p&gt;
    
    </summary>
    
      <category term="CI" scheme="http://yoursite.com/categories/CI/"/>
    
    
      <category term="jenkins" scheme="http://yoursite.com/tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>Vue 常见问题汇总</title>
    <link href="http://yoursite.com/2020/02/10/vue-faq/"/>
    <id>http://yoursite.com/2020/02/10/vue-faq/</id>
    <published>2020-02-10T06:34:00.000Z</published>
    <updated>2020-02-23T12:27:56.016Z</updated>
    
    <content type="html"><![CDATA[<p>先记录下自己写前端遇到过的问题。</p><a id="more"></a><ol><li>父页面设置子组件的显示和隐藏</li><li>覆盖组件样式： <a href="https://www.cnblogs.com/CyLee/p/10006065.html" target="_blank" rel="noopener">https://www.cnblogs.com/CyLee/p/10006065.html</a></li><li></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;先记录下自己写前端遇到过的问题。&lt;/p&gt;
    
    </summary>
    
      <category term="js" scheme="http://yoursite.com/categories/js/"/>
    
    
      <category term="vue" scheme="http://yoursite.com/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>go channel</title>
    <link href="http://yoursite.com/2020/01/31/go-channel/"/>
    <id>http://yoursite.com/2020/01/31/go-channel/</id>
    <published>2020-01-31T05:06:27.000Z</published>
    <updated>2020-01-31T05:41:17.533Z</updated>
    
    <content type="html"><![CDATA[<p>go 社区有一句口号：”不要通过共享内存来通信，而应该通过通信来共享内存”, channel 用于 goroutine 之间传递消息。如果是多进程之间的通信，还是推荐使用 socket 或者 http.</p><a id="more"></a><h2 id="channel-操作"><a href="#channel-操作" class="headerlink" title="channel 操作"></a>channel 操作</h2><h3 id="声明和定义"><a href="#声明和定义" class="headerlink" title="声明和定义"></a>声明和定义</h3><p>channel 只能发送指定类型的数据，因此channel的声明和定义必须指定类型；</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明一个 int类型的 channel</span></span><br><span class="line"><span class="keyword">var</span> ch1 <span class="keyword">chan</span> <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个不带缓存的 channel</span></span><br><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个带缓存的 channel</span></span><br><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 channel 容量</span></span><br><span class="line"><span class="built_in">cap</span>(ch)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 channel 现有长度、</span></span><br><span class="line"><span class="built_in">len</span>(ch)</span><br></pre></td></tr></table></figure><h3 id="channel-的缓存"><a href="#channel-的缓存" class="headerlink" title="channel 的缓存"></a>channel 的缓存</h3><p>从无缓存的 channel 中读取消息，会发生阻塞，直到有 goroutine 向该channel 发送消息；同理向无缓存的channle发送消息也会阻塞，直到有 goroutine 读取该channel中的消息。</p><blockquote><p>通过无缓存的channel进行通信时，接受者收到数据 happens before 发送者 goroutine 唤醒</p></blockquote><p>有缓存的 channel 当缓存未满时，发送消息不会阻塞，当缓存慢时，发送消息会阻塞。当缓存不为空时，读取消息不会阻塞，缓存为空时，读取消息会阻塞。</p><blockquote><p>许式伟《go语言编程》中关于 channel 的例子有点小问题，如果是等待 gorotine 完成，建议把写 channel 的操作放在函数的最后，避免 channel 刚写完，就被读取，而其它部分代码还没执行就退出了。</p></blockquote><h3 id="channel-数据发送和读取"><a href="#channel-数据发送和读取" class="headerlink" title="channel 数据发送和读取"></a>channel 数据发送和读取</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 写入数据</span></span><br><span class="line">ch &lt;- <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取数据</span></span><br><span class="line">value := &lt;- ch</span><br></pre></td></tr></table></figure><p>还可以使用 range 来读取 channel</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x := <span class="keyword">range</span> ch &#123;</span><br><span class="line">  fmt.Println(x)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>range 会一直从 channel 中取值，直到有 goroutine 对该 channel 调用 close 操作。上面的代码等价于:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">  x, ok := &lt;- ch</span><br><span class="line">  <span class="keyword">if</span> !ok &#123;</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println(x)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="close"><a href="#close" class="headerlink" title="close"></a>close</h3>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;go 社区有一句口号：”不要通过共享内存来通信，而应该通过通信来共享内存”, channel 用于 goroutine 之间传递消息。如果是多进程之间的通信，还是推荐使用 socket 或者 http.&lt;/p&gt;
    
    </summary>
    
      <category term="go" scheme="http://yoursite.com/categories/go/"/>
    
    
      <category term="go" scheme="http://yoursite.com/tags/go/"/>
    
  </entry>
  
  <entry>
    <title>go 包管理</title>
    <link href="http://yoursite.com/2019/12/29/go-pkg/"/>
    <id>http://yoursite.com/2019/12/29/go-pkg/</id>
    <published>2019-12-29T04:14:36.000Z</published>
    <updated>2020-01-31T05:12:55.829Z</updated>
    
    <content type="html"><![CDATA[<p>import 别名</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> log <span class="string">"github.com/sirupsen/logrus"</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;import 别名&lt;/p&gt;
&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;
      
    
    </summary>
    
      <category term="go" scheme="http://yoursite.com/categories/go/"/>
    
    
      <category term="go" scheme="http://yoursite.com/tags/go/"/>
    
  </entry>
  
  <entry>
    <title>etcd 速查手册</title>
    <link href="http://yoursite.com/2019/12/20/etcd/"/>
    <id>http://yoursite.com/2019/12/20/etcd/</id>
    <published>2019-12-20T02:49:52.000Z</published>
    <updated>2020-02-15T03:14:34.087Z</updated>
    
    <content type="html"><![CDATA[<p>Etcd 是一个 key-value 数据库，从官方的定义可以看出<code>etcd</code>主要用于：</p><ul><li>服务发现</li><li>配置共享</li></ul><a id="more"></a><p>定义：</p><blockquote><p>A highly-available key value store for shared configuration and service discovery.</p></blockquote><h2 id="查看版本信息"><a href="#查看版本信息" class="headerlink" title="查看版本信息"></a>查看版本信息</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl version</span><br><span class="line">etcdctl version: 3.3.13</span><br><span class="line">API version: 3.3</span><br></pre></td></tr></table></figure><h2 id="key-操作"><a href="#key-操作" class="headerlink" title="key 操作"></a>key 操作</h2><h3 id="添加-key"><a href="#添加-key" class="headerlink" title="添加 key"></a>添加 key</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加 key</span></span><br><span class="line">$ etcdctl put foo bar</span><br><span class="line">OK</span><br></pre></td></tr></table></figure><h3 id="获取-key"><a href="#获取-key" class="headerlink" title="获取 key"></a>获取 key</h3><p>etcdctl 读取 key 值的时候会把key 也输出，如果有多个 key，会连着输出，中间没有空行，有点蛋疼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取 key</span></span><br><span class="line">$ etcdctl get foo</span><br><span class="line">foo</span><br><span class="line">bar</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取 key --prefix</span></span><br><span class="line">$ etcdctl get --prefix f</span><br><span class="line">foo</span><br><span class="line">bar</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只显示 key</span></span><br><span class="line">$ etcdctl get foo --keys-only</span><br><span class="line">foo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只显示 value</span></span><br><span class="line">$ etcdctl get foo --<span class="built_in">print</span>-value-only</span><br><span class="line">bar</span><br></pre></td></tr></table></figure><h3 id="删除key"><a href="#删除key" class="headerlink" title="删除key"></a>删除key</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl del cc</span><br><span class="line">1</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Etcd 是一个 key-value 数据库，从官方的定义可以看出&lt;code&gt;etcd&lt;/code&gt;主要用于：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;服务发现&lt;/li&gt;
&lt;li&gt;配置共享&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>k8s-cert</title>
    <link href="http://yoursite.com/2019/12/02/k8s-cert/"/>
    <id>http://yoursite.com/2019/12/02/k8s-cert/</id>
    <published>2019-12-02T08:38:36.000Z</published>
    <updated>2019-12-02T08:43:41.291Z</updated>
    
    <content type="html"><![CDATA[<p>使用kubeadm 搭建的 k8s 环境，证书模式有效期是一年，到一年</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;使用kubeadm 搭建的 k8s 环境，证书模式有效期是一年，到一年&lt;/p&gt;

      
    
    </summary>
    
    
      <category term="k8s 证书问题" scheme="http://yoursite.com/tags/k8s-%E8%AF%81%E4%B9%A6%E9%97%AE%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>redis</title>
    <link href="http://yoursite.com/2019/11/22/redis/"/>
    <id>http://yoursite.com/2019/11/22/redis/</id>
    <published>2019-11-22T08:47:59.000Z</published>
    <updated>2019-11-22T08:50:15.673Z</updated>
    
    <content type="html"><![CDATA[<h2 id="redis-主从复制"><a href="#redis-主从复制" class="headerlink" title="redis 主从复制"></a>redis 主从复制</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果主服务设置了密码</span></span><br><span class="line">config <span class="built_in">set</span> masterauth &lt;<span class="built_in">pwd</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置主服务器</span></span><br><span class="line">SLAVEOF 192.168.1.100 6379</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取消同步</span></span><br><span class="line">SLAVEOF NO ONE</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;redis-主从复制&quot;&gt;&lt;a href=&quot;#redis-主从复制&quot; class=&quot;headerlink&quot; title=&quot;redis 主从复制&quot;&gt;&lt;/a&gt;redis 主从复制&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>mysql 分区, 分库，分表</title>
    <link href="http://yoursite.com/2019/11/06/mysql-part/"/>
    <id>http://yoursite.com/2019/11/06/mysql-part/</id>
    <published>2019-11-06T14:44:00.000Z</published>
    <updated>2020-02-15T03:15:49.920Z</updated>
    
    <content type="html"><![CDATA[<h2 id="分区"><a href="#分区" class="headerlink" title="分区"></a>分区</h2><p><strong>什么是分区</strong></p><p>将一个表拆解成多个区块。</p><a id="more"></a><p><strong>分区的好处</strong></p><ol><li>进行逻辑数据分割，分割数据能有多个不同的物理文件路径；</li><li>可以存储更多的数据，突破系统单个文件最大限制；</li><li>提升性能，提高每个分区的读写速度，提高分区范围内的查询速度；</li><li>可以通过删除分区来快速删除数据，例如分区是按年份划分；</li><li>通过跨磁盘来分散数据，从而提高磁盘I/O性能；</li><li>涉及到SUM， COUNT等聚合函数，可以并行计算；</li><li>可以备份恢复独立分区，对大数据量有好处；</li></ol><p><strong>分区能支持的引擎</strong></p><p>同一个表中的所有分区必须是同一个引擎；</p><h3 id="查看是否支持分区"><a href="#查看是否支持分区" class="headerlink" title="查看是否支持分区"></a>查看是否支持分区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; show plugins;</span><br><span class="line"></span><br><span class="line">+-------------------------------+----------+--------------------+---------+---------+</span><br><span class="line">| partition                     | ACTIVE   | STORAGE ENGINE     | NULL    | GPL     |</span><br><span class="line">+-------------------------------+----------+--------------------+---------+---------+</span><br></pre></td></tr></table></figure><p>分区类型</p><ol><li>RANGE 分区；</li><li>LIST 分区；</li><li>HASH分区；</li><li>KEY分区，类似HASH分区，由MySQL服务器提供其自身的哈希函数；</li></ol><h2 id="分表"><a href="#分表" class="headerlink" title="分表"></a>分表</h2><p><strong>好处</strong></p><h2 id="分库"><a href="#分库" class="headerlink" title="分库"></a>分库</h2>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;分区&quot;&gt;&lt;a href=&quot;#分区&quot; class=&quot;headerlink&quot; title=&quot;分区&quot;&gt;&lt;/a&gt;分区&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;什么是分区&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;将一个表拆解成多个区块。&lt;/p&gt;
    
    </summary>
    
    
      <category term="mysql" scheme="http://yoursite.com/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>elasticsearch dsl使用</title>
    <link href="http://yoursite.com/2019/10/31/es-dsl/"/>
    <id>http://yoursite.com/2019/10/31/es-dsl/</id>
    <published>2019-10-31T03:04:15.000Z</published>
    <updated>2020-04-09T03:23:41.413Z</updated>
    
    <content type="html"><![CDATA[<p>elasticsearch_dsl 库可以方便的生成一些复杂的 dsl 语句，而不用自己去写 json.</p><a id="more"></a><h3 id="指定-source"><a href="#指定-source" class="headerlink" title="指定 _source"></a>指定 <code>_source</code></h3><p>指定确定的字段</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> elasticsearch_dsl <span class="keyword">import</span> Search</span><br><span class="line"></span><br><span class="line">s = Source()</span><br><span class="line">s = s.source([<span class="string">'attacker_ip'</span>, <span class="string">'attacker_id'</span>])</span><br><span class="line">print(s.to_dict())</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#123;'query': &#123;'match_all': &#123;&#125;&#125;, '_source': ['attacker_ip', 'attacker_id']</span></span><br></pre></td></tr></table></figure><p>使用 <code>include</code>和 <code>exclude</code> ，需要注意的是两种方式不能同时使用</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> elasticsearch_dsl <span class="keyword">import</span> Search</span><br><span class="line"></span><br><span class="line">s = Source()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要注意的是 source 并不是在原有对象上修改，需要重新赋值</span></span><br><span class="line">s = s.source(include=[<span class="string">'attacker_id'</span>], exclude=[<span class="string">"time*"</span>])</span><br><span class="line">print(s.to_dict())</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#123;'query': &#123;'match_all': &#123;&#125;&#125;, '_source': &#123;'include': ['attacker_id'], 'exclude': ['time*']&#125;&#125;</span></span><br></pre></td></tr></table></figure><h2 id="逻辑操作"><a href="#逻辑操作" class="headerlink" title="逻辑操作"></a>逻辑操作</h2> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Q() &amp; Q() | ~Q()</span><br></pre></td></tr></table></figure><h2 id="取子属性"><a href="#取子属性" class="headerlink" title="取子属性"></a>取子属性</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># eg 要获取 attacker.city， 使用 __ 代替 .</span></span><br><span class="line">Q(<span class="string">"term"</span>, attacker__city=<span class="string">"杭州"</span>)</span><br></pre></td></tr></table></figure><h2 id="嵌套"><a href="#嵌套" class="headerlink" title="嵌套"></a>嵌套</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">city_q = Q(<span class="string">'nested'</span>, path=<span class="string">'victims'</span>, query=~Q(<span class="string">'term'</span>, victims__location__city=<span class="string">""</span>))</span><br></pre></td></tr></table></figure><p>对应下面的 json</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"bool"</span>: &#123;</span><br><span class="line">            <span class="attr">"must"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"nested"</span>: &#123;</span><br><span class="line">                        <span class="attr">"path"</span>: <span class="string">"victims"</span>,</span><br><span class="line">                        <span class="attr">"query"</span>: &#123;</span><br><span class="line">                            <span class="attr">"bool"</span>: &#123;</span><br><span class="line">                                <span class="attr">"must_not"</span>: [</span><br><span class="line">                                    &#123;</span><br><span class="line">                                        <span class="attr">"term"</span>: &#123;</span><br><span class="line">                                            <span class="attr">"victims.location.city"</span>: <span class="string">""</span></span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                ]</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;elasticsearch_dsl 库可以方便的生成一些复杂的 dsl 语句，而不用自己去写 json.&lt;/p&gt;
    
    </summary>
    
    
      <category term="elasticsearch" scheme="http://yoursite.com/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>rabbitmq 命令速查</title>
    <link href="http://yoursite.com/2019/10/24/rabbitmqctl/"/>
    <id>http://yoursite.com/2019/10/24/rabbitmqctl/</id>
    <published>2019-10-24T08:29:24.000Z</published>
    <updated>2019-10-24T08:30:10.886Z</updated>
    
    <content type="html"><![CDATA[<h3 id="清空队列"><a href="#清空队列" class="headerlink" title="清空队列"></a>清空队列</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl purge_queue queue_name</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;清空队列&quot;&gt;&lt;a href=&quot;#清空队列&quot; class=&quot;headerlink&quot; title=&quot;清空队列&quot;&gt;&lt;/a&gt;清空队列&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre
      
    
    </summary>
    
    
      <category term="mq" scheme="http://yoursite.com/tags/mq/"/>
    
  </entry>
  
  <entry>
    <title>selenium 集群搭建</title>
    <link href="http://yoursite.com/2019/09/20/selenium/"/>
    <id>http://yoursite.com/2019/09/20/selenium/</id>
    <published>2019-09-20T03:36:57.000Z</published>
    <updated>2019-09-20T06:35:29.775Z</updated>
    
    <content type="html"><![CDATA[<p>本文以 centos 为例，介绍下如何搭建 selenium 集群。</p><a id="more"></a><p>##selenium 安装</p><h3 id="chrome-安装"><a href="#chrome-安装" class="headerlink" title="chrome 安装"></a>chrome 安装</h3><h3 id="chrome-driver-安装"><a href="#chrome-driver-安装" class="headerlink" title="chrome driver 安装"></a>chrome driver 安装</h3><p>从 <a href="http://chromedriver.storage.googleapis.com/index.html" target="_blank" rel="noopener">http://chromedriver.storage.googleapis.com/index.html</a> 下载之后解压到到 <code>/usr/bin/</code> 目录即可。macos可以使用 <code>brew</code>安装:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew cask install chromedriver</span><br></pre></td></tr></table></figure><h2 id="设置-headless"><a href="#设置-headless" class="headerlink" title="设置 headless"></a>设置 headless</h2><p>所谓 <code>headless</code>就是不用 <code>GUI</code>, 设置方式如下 ：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"></span><br><span class="line">options = Options()</span><br><span class="line">options.add_argument(<span class="string">'--headless'</span>)</span><br><span class="line">options.add_argument(<span class="string">'--disable-gpu'</span>)  <span class="comment"># Last I checked this was necessary.</span></span><br><span class="line">options.add_argument(<span class="string">'--disable-dev-shm-usage'</span>)</span><br><span class="line">options.add_argument(<span class="string">'--no-sandbox'</span>)</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome(options=options)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文以 centos 为例，介绍下如何搭建 selenium 集群。&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>python-future</title>
    <link href="http://yoursite.com/2019/08/22/python-future/"/>
    <id>http://yoursite.com/2019/08/22/python-future/</id>
    <published>2019-08-22T01:50:52.000Z</published>
    <updated>2019-09-18T09:42:34.160Z</updated>
    
    <content type="html"><![CDATA[<p>future 是 python 的的并发库，py2 需要单独安装，py3已经集成到标准库中了。future用的比较多的是线程池和进程池。</p><a id="more"></a><h2 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> as_completed</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(i)</span>:</span></span><br><span class="line">  <span class="comment"># do something</span></span><br><span class="line">  time.sleep(random.randint(<span class="number">1</span>, <span class="number">5</span>))</span><br><span class="line"><span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line"><span class="comment"># max_workers 指定线程池大小，如果不指定默认是 cpu *5</span></span><br><span class="line">p = ThreadPoolExecutor(max_workers=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交任务</span></span><br><span class="line">tasks = [p.submit(foo, i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取返回结果, 这里的返回并不是按照提交顺序来的，而是谁先完成，谁先返回</span></span><br><span class="line"><span class="keyword">for</span> future <span class="keyword">in</span> as_completed(tasks):</span><br><span class="line">  print(future.result())</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 如果希望有序返回，使用 map</span></span><br><span class="line"><span class="comment"># 这里 result 是生成器，可以使用 list(result) 转换为 list 类型</span></span><br><span class="line">result = p.map(foo, range(<span class="number">10</span>))</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;future 是 python 的的并发库，py2 需要单独安装，py3已经集成到标准库中了。future用的比较多的是线程池和进程池。&lt;/p&gt;
    
    </summary>
    
      <category term="python" scheme="http://yoursite.com/categories/python/"/>
    
    
  </entry>
  
  <entry>
    <title>单机性能分析</title>
    <link href="http://yoursite.com/2019/08/22/io/"/>
    <id>http://yoursite.com/2019/08/22/io/</id>
    <published>2019-08-22T01:34:04.000Z</published>
    <updated>2019-08-22T01:43:16.515Z</updated>
    
    <content type="html"><![CDATA[<p>给你一台服务器或者虚拟机，怎么充分发挥性能呢？</p><a id="more"></a><h1 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h1><p>如果是计算密集形的任务，主要瓶颈可能在CPU, 可以通过 top 命令查看 cpu的使用率。</p><h1 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h1><p>内存不光涉及使用率，还有换页等。</p><h1 id="硬盘I-O"><a href="#硬盘I-O" class="headerlink" title="硬盘I/O"></a>硬盘I/O</h1><h2 id="iostat"><a href="#iostat" class="headerlink" title="iostat"></a>iostat</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">yum install sysstat -y</span><br><span class="line"></span><br><span class="line">iostat</span><br><span class="line">Linux 3.10.0-514.26.2.el7.v7.4.x86_64 (centos) 08/22/2019 _x86_64_(4 CPU)</span><br><span class="line"></span><br><span class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</span><br><span class="line">           2.61    0.00    0.45    0.00    0.00   96.94</span><br><span class="line"></span><br><span class="line">Device:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn</span><br><span class="line">sda               0.52         0.12      1727.75     515932 7572051863</span><br></pre></td></tr></table></figure><h1 id="网络I-O"><a href="#网络I-O" class="headerlink" title="网络I/O"></a>网络I/O</h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;给你一台服务器或者虚拟机，怎么充分发挥性能呢？&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>go 操作 ElasticSearch</title>
    <link href="http://yoursite.com/2019/08/21/go-es/"/>
    <id>http://yoursite.com/2019/08/21/go-es/</id>
    <published>2019-08-21T03:22:01.000Z</published>
    <updated>2019-08-21T03:28:58.000Z</updated>
    
    <content type="html"><![CDATA[<p>go 操作ES并不像 python 那么直观，需要使用很多的 struct 和 函数，感觉没有 python 的 dict 好用。本文以<code>v5</code>版本为例说明。</p><a id="more"></a><h2 id="建立连接"><a href="#建立连接" class="headerlink" title="建立连接"></a>建立连接</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"gopkg.in/olivere/elastic.v5"</span></span><br><span class="line"></span><br><span class="line">client, err := elastic.NewClient(elastic.SetURL(<span class="string">"http://192.168.1.100:9296"</span>))</span><br></pre></td></tr></table></figure><h2 id="查看dsl-语句"><a href="#查看dsl-语句" class="headerlink" title="查看dsl 语句"></a>查看dsl 语句</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"encoding/json"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"gopkg.in/olivere/elastic.v5"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">query := elastic.NewBoolQuery()</span><br><span class="line">query = query.Must(elastic.NewTermQuery(<span class="string">"user"</span>, <span class="string">"olivere"</span>))</span><br><span class="line">query = query.Filter(elastic.NewTermQuery(<span class="string">"account"</span>, <span class="number">1</span>))</span><br><span class="line">src, err := query.Source()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data, err := json.MarshalIndent(src, <span class="string">""</span>, <span class="string">"  "</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"> <span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   "bool": &#123;</span></span><br><span class="line"><span class="comment">//     "filter": &#123;</span></span><br><span class="line"><span class="comment">//       "term": &#123;</span></span><br><span class="line"><span class="comment">//         "account": 1</span></span><br><span class="line"><span class="comment">//       &#125;</span></span><br><span class="line"><span class="comment">//     &#125;,</span></span><br><span class="line"><span class="comment">//     "must": &#123;</span></span><br><span class="line"><span class="comment">//       "term": &#123;</span></span><br><span class="line"><span class="comment">//         "user": "olivere"</span></span><br><span class="line"><span class="comment">//       &#125;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;go 操作ES并不像 python 那么直观，需要使用很多的 struct 和 函数，感觉没有 python 的 dict 好用。本文以&lt;code&gt;v5&lt;/code&gt;版本为例说明。&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>kafka 常用命令</title>
    <link href="http://yoursite.com/2019/08/19/kafka/"/>
    <id>http://yoursite.com/2019/08/19/kafka/</id>
    <published>2019-08-19T10:42:48.000Z</published>
    <updated>2020-02-18T04:42:40.840Z</updated>
    
    <content type="html"><![CDATA[<p>kafka 常用命令。</p><a id="more"></a><h2 id="生产者"><a href="#生产者" class="headerlink" title="生产者"></a>生产者</h2><h3 id="发送消息"><a href="#发送消息" class="headerlink" title="发送消息"></a>发送消息</h3><p>发送消息有如下三中方式：</p><ul><li>发送并忘记(fire-and-forget): 不关心消息是否达到，大部分时候是可靠的，可能会丢一部分消息；</li><li>同步发送：</li><li>异步发送</li></ul><h2 id="topic-相关"><a href="#topic-相关" class="headerlink" title="topic 相关"></a>topic 相关</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 topic</span></span><br><span class="line">./kafka-topics.sh --create --zookeeper zookeeper:2181 --replication-factor 1 --partitions 1 --topic <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#列出所有 topic</span></span><br><span class="line">./kafka-topics.sh --zookeeper zookeeper:2181/kafka --list</span><br></pre></td></tr></table></figure><p>查看 topic</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ./kafka-topics.sh --zookeeper zookeeper:2181 --describe --topic test</span></span><br><span class="line"></span><br><span class="line">Topic:<span class="built_in">test</span>PartitionCount:1ReplicationFactor:1Configs:</span><br><span class="line">Topic: <span class="built_in">test</span>Partition: 0Leader: 0Replicas: 0Isr: 0</span><br></pre></td></tr></table></figure><p>增加分区数量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ./kafka-topics.sh --zookeeper zookeeper:2181 --alter --topic test --partitions 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ./kafka-topics.sh --zookeeper zookeeper:2181 --describe --topic test</span></span><br><span class="line">Topic:<span class="built_in">test</span>PartitionCount:4ReplicationFactor:1Configs:</span><br><span class="line">Topic: <span class="built_in">test</span>Partition: 0Leader: 0Replicas: 0Isr: 0</span><br><span class="line">Topic: <span class="built_in">test</span>Partition: 1Leader: 0Replicas: 0Isr: 0</span><br><span class="line">Topic: <span class="built_in">test</span>Partition: 2Leader: 0Replicas: 0Isr: 0</span><br><span class="line">Topic: <span class="built_in">test</span>Partition: 3Leader: 0Replicas: 0Isr: 0</span><br></pre></td></tr></table></figure><h2 id="消息相关"><a href="#消息相关" class="headerlink" title="消息相关"></a>消息相关</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 发送消息</span></span><br><span class="line">./kafka-console-producer.sh --broker-list localhost:9092 --topic <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 消费消息</span></span><br><span class="line">./kafka-console-consumer.sh  --bootstrap-server localhost:9092 --topic <span class="built_in">test</span> --from-beginning</span><br><span class="line"></span><br><span class="line"><span class="comment"># 消费一条消息</span></span><br><span class="line">./kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic t_my_topic --max-messages 1</span><br></pre></td></tr></table></figure><h2 id="group-相关"><a href="#group-相关" class="headerlink" title="group 相关"></a>group 相关</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#列出所有 consumer group</span></span><br><span class="line">./kafka-consumer-groups.sh --bootstrap-server localhost:9092 --list</span><br><span class="line"></span><br><span class="line"><span class="comment">#某个 consumer group 信息</span></span><br><span class="line">./kafka-consumer-groups.sh --bootstrap-server localhost:9092 --describe --group group_id_qa</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将某个 group 的 topic 重置到 earliest</span></span><br><span class="line">./kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group example --topic aether_hosts --execute --reset-offsets --to-earliest</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;kafka 常用命令。&lt;/p&gt;
    
    </summary>
    
    
      <category term="kafka" scheme="http://yoursite.com/tags/kafka/"/>
    
  </entry>
  
  <entry>
    <title>alpine</title>
    <link href="http://yoursite.com/2019/07/25/alpine/"/>
    <id>http://yoursite.com/2019/07/25/alpine/</id>
    <published>2019-07-25T03:41:22.000Z</published>
    <updated>2019-08-06T11:24:22.603Z</updated>
    
    <content type="html"><![CDATA[<p>alpine 是一个很小的linux 镜像，只有十几M大小，很适合部分服务。不过 alpine 的 c 库不是 glibc，所以依赖 glibc 时会有一些问题。</p><a id="more"></a><h2 id="定制时区"><a href="#定制时区" class="headerlink" title="定制时区"></a>定制时区</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">apk add tzdata --no-cache</span><br><span class="line">ls /usr/share/zoneinfo</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Europe/Brussels"</span> &gt;  /etc/timezone</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者通过环境变量方式设置</span></span><br><span class="line">ENV TZ Asia/Shanghai</span><br></pre></td></tr></table></figure><h2 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h2><p>alpine 的 gcc 不是标准的 glibc, 使用 mysql 时有点问题，需要用下面的sed 命令修改下。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apk add --no-cache mariadb-dev gcc musl-dev</span><br><span class="line">sed <span class="string">'/st_mysql_options options;/a unsigned int reconnect;'</span> /usr/include/mysql/mysql.h -i.bkp</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;alpine 是一个很小的linux 镜像，只有十几M大小，很适合部分服务。不过 alpine 的 c 库不是 glibc，所以依赖 glibc 时会有一些问题。&lt;/p&gt;
    
    </summary>
    
    
      <category term="docker" scheme="http://yoursite.com/tags/docker/"/>
    
  </entry>
  
</feed>
